<!DOCTYPE html>
<html lang="en">
<head>
  <!-- Your exact original head content -->
  <style>
    /* Your exact original CSS */
  </style>
</head>
<body>
  <!-- Your exact original HTML structure -->
  <div class="dashboard">
    <!-- All your original elements -->
  </div>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
  
  <script>
    // Initialize Firebase
    const firebaseConfig = {
      apiKey: "AIzaSyAuzAP-nBbSZfLPhHRpUM12Ikx29X8cubc",
      authDomain: "wallet-dashboard-c1f5b.firebaseapp.com",
      databaseURL: "https://wallet-dashboard-c1f5b-default-rtdb.firebaseio.com",
      projectId: "wallet-dashboard-c1f5b",
      storageBucket: "wallet-dashboard-c1f5b.appspot.com",
      messagingSenderId: "256709610703",
      appId: "1:256709610703:web:64abb94f87aab57beefbba",
      measurementId: "G-LTXHVWPBLR"
    };
    firebase.initializeApp(firebaseConfig);
    const database = firebase.database();

    // Your original variables
    const balanceDisplay = document.getElementById("balanceDisplay");
    const statusBox = document.getElementById("statusBox");
    const logBox = document.getElementById("logBox");
    const idleMsg = document.getElementById("idleMsg");

    // Combined storage approach
    let balance, logs;

    // 1. First check localStorage (for instant display)
    balance = localStorage.getItem("walletBalance") ? parseInt(localStorage.getItem("walletBalance")) : 5000000;
    logs = localStorage.getItem("walletLogs") ? JSON.parse(localStorage.getItem("walletLogs")) : [];
    
    // 2. Then sync with Firebase (for cross-browser persistence)
    const walletRef = database.ref('walletData');
    walletRef.on('value', (snapshot) => {
      const data = snapshot.val();
      if (data) {
        // Only update if Firebase has newer data
        if (!localStorage.getItem("lastUpdate") || data.lastUpdate > localStorage.getItem("lastUpdate")) {
          balance = data.balance;
          logs = data.logs;
          localStorage.setItem("walletBalance", balance);
          localStorage.setItem("walletLogs", JSON.stringify(logs));
          localStorage.setItem("lastUpdate", Date.now());
          updateBalanceDisplay();
          renderLogs();
        }
      }
    });

    // Your original render functions
    function renderLogs() {
      logBox.innerHTML = "";
      for (const log of logs) {
        const div = document.createElement("div");
        div.className = "log-entry";
        div.textContent = log;
        logBox.appendChild(div);
      }
    }

    function updateBalanceDisplay() {
      balanceDisplay.textContent = `$${balance.toLocaleString()}`;
    }

    // Modified to sync to both storage systems
    function syncData() {
      const now = Date.now();
      localStorage.setItem("walletBalance", balance);
      localStorage.setItem("walletLogs", JSON.stringify(logs));
      localStorage.setItem("lastUpdate", now);
      walletRef.set({
        balance: balance,
        logs: logs,
        lastUpdate: now
      });
    }

    // Your original functions with sync added
    function deductBalance(amount) {
      balance -= amount;
      if (balance <= 0) {
        updateBalanceDisplay();
        logActivity("Balance depleted");
        setTimeout(() => {
          balance = 5000000;
          updateBalanceDisplay();
          logActivity("Balance refilled to $5,000,000");
          logs = [];
          syncData();
          renderLogs();
        }, 3000);
      } else {
        updateBalanceDisplay();
      }
      syncData();
    }

    function logActivity(message) {
      const timestampedMsg = `${new Date().toLocaleTimeString()} - ${message}`;
      logs.unshift(timestampedMsg);
      syncData();
      renderLogs();
    }

    // Rest of your original functions remain exactly the same
    function simulateWalletConnection() {
      /* Your original code */
    }
    function showStatus() {
      /* Your original code */
    }
    function generateAddress() {
      /* Your original code */
    }
    function randomIntervalCall() {
      /* Your original code */
    }

    // Initialize
    updateBalanceDisplay();
    renderLogs();
    randomIntervalCall();
  </script>
</body>
</html>
