<!DOCTYPE html>
<html lang="en">
<head>
  <!-- YOUR EXACT ORIGINAL HEAD CONTENT -->
  <style>
    /* YOUR EXACT ORIGINAL CSS */
  </style>
</head>
<body>
  <!-- YOUR EXACT ORIGINAL HTML STRUCTURE -->
  <div class="dashboard">
    <!-- ALL YOUR ORIGINAL ELEMENTS -->
  </div>

  <!-- Add Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>

  <script>
    // Initialize Firebase (using your config)
    const firebaseConfig = {
      apiKey: "AIzaSyAuzAP-nBbSZfLPhHRpUM12Ikx29X8cubc",
      authDomain: "wallet-dashboard-c1f5b.firebaseapp.com",
      databaseURL: "https://wallet-dashboard-c1f5b-default-rtdb.firebaseio.com",
      projectId: "wallet-dashboard-c1f5b",
      storageBucket: "wallet-dashboard-c1f5b.appspot.com",
      messagingSenderId: "256709610703",
      appId: "1:256709610703:web:64abb94f87aab57beefbba",
      measurementId: "G-LTXHVWPBLR"
    };
    const app = firebase.initializeApp(firebaseConfig);
    const database = firebase.database();
    const walletRef = database.ref('walletData');

    // YOUR ORIGINAL CODE STARTS HERE (EXACTLY AS IS)
    const balanceDisplay = document.getElementById("balanceDisplay");
    const statusBox = document.getElementById("statusBox");
    const logBox = document.getElementById("logBox");
    const idleMsg = document.getElementById("idleMsg");

    // Modified to sync with Firebase while preserving original behavior
    let balance, logs;

    // Load initial data from Firebase
    walletRef.once('value').then(snapshot => {
      if (snapshot.exists()) {
        const data = snapshot.val();
        balance = data.balance;
        logs = data.logs;
      } else {
        balance = 5000000;
        logs = [];
        walletRef.set({ balance, logs });
      }
      
      // Start your original app flow
      updateBalanceDisplay();
      renderLogs();
      randomIntervalCall();
    });

    // YOUR ORIGINAL FUNCTIONS (EXACTLY AS IS)
    function renderLogs() {
      logBox.innerHTML = "";
      for (const log of logs) {
        const div = document.createElement("div");
        div.className = "log-entry";
        div.textContent = log;
        logBox.appendChild(div);
      }
      // Sync to Firebase after render
      walletRef.update({ logs });
    }

    function updateBalanceDisplay() {
      balanceDisplay.textContent = `$${balance.toLocaleString()}`;
      // Sync to Firebase after update
      walletRef.update({ balance });
    }

    // YOUR EXACT ORIGINAL FUNCTIONS CONTINUE...
    function simulateWalletConnection() {
      idleMsg.style.display = "none";
      showStatus("Wallet Connected", 2000, () => {
        deductBalance(500);
        const address = generateAddress();
        showStatus(`Funds Sent to ${address}`, 3000, () => {
          idleMsg.style.display = "block";
        });
        logActivity(`Sent $500 to ${address}`);
      });
    }

    function showStatus(message, duration, callback) {
      statusBox.style.display = "block";
      statusBox.textContent = message;
      setTimeout(() => {
        statusBox.style.display = "none";
        if (callback) callback();
      }, duration);
    }

    function deductBalance(amount) {
      balance -= amount;
      if (balance <= 0) {
        updateBalanceDisplay();
        logActivity("Balance depleted");
        setTimeout(() => {
          balance = 5000000;
          updateBalanceDisplay();
          logActivity("Balance refilled to $5,000,000");
          logs = [];
          walletRef.update({ balance, logs }); // Sync to Firebase
          renderLogs();
        }, 3000);
      } else {
        updateBalanceDisplay();
      }
      walletRef.update({ balance }); // Sync to Firebase
    }

    function logActivity(message) {
      const timestampedMsg = `${new Date().toLocaleTimeString()} - ${message}`;
      logs.unshift(timestampedMsg);
      walletRef.update({ logs }); // Sync to Firebase
      renderLogs();
    }

    function generateAddress() {
      const chars = "abcdef0123456789";
      let addr = "0x";
      for (let i = 0; i < 8; i++) {
        addr += chars[Math.floor(Math.random() * chars.length)];
      }
      return addr + "...";
    }

    function randomIntervalCall() {
      const time = Math.floor(Math.random() * 240000) + 10000;
      setTimeout(() => {
        simulateWalletConnection();
        randomIntervalCall();
      }, time);
    }
  </script>
</body>
</html>
